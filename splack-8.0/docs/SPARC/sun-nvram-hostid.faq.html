<!DOCTYPE HTML PUBLIC "-//SQ//DTD HTML 2.0 HoTMetaL + extensions//EN">
<HTML>
<HEAD>
<TITLE>SUN NVRAM/hostid FAQ</TITLE></HEAD>
<BODY>
<H1>Frequently Asked Questions about Sun NVRAM/hostid</H1>
<P><SMALL>$Date: 2000/03/03 18:27:20 $</SMALL></P>
<P><SMALL>$Revision: 1.61 $</SMALL></P>
<P><SMALL>This document has been placed in the public domain by the author - 
<A HREF="mailto:mch@squirrel.com">Mark Henderson &lt;mch@squirrel.com&gt;</A></SMALL></P>
<P><FONT COLOR="#8b3a3a"><STRONG>If this information is abused,
misinterpreted, or incorrect you can render your computer unbootable. The
information in this document is distributed in the hope that it will be useful,
but without any warranty; without even the implied warranty of merchantability
or fitness for a particular purpose. You use this document at your own risk. The
author disclaims responsibility for any damages that might result from the use
of this document, even if they result from negligence or errors on the part of
the author. Please do not use the information in this document to steal software
or violate licence agreements with software vendors.</STRONG></FONT></P>
<P>This is the new and hopefully improved Sun NVRAM FAQ. It is an attempt to
answer the following frequently asked questions on comp.sys.sun.hardware and
comp.sys.sun.admin.</P>
<OL>
<LI>When I turn on my Sun I get output which looks something like:
<PRE>Sun Workstation, Model Sun-XXXXXX Series. 
ROM Rev X.X, XXMB memory installed
ID PROM invalid.
Testing 0 Megabytes of Memory ... Completed.
ERROR: missing or invalid ID prom
Requesting Internet address for 0:0:0:0:0:0
</PRE>
<P>or</P>
<PRE>Sun Workstation, Model Sun-XXXX Series.
Type 4 Keyboard
ROM Rev X.X, XXMB memory installed, Serial #16777215
Ethernet address ff:ff:ff:ff:ff:ff, Host ID ffffffff

Invalid format type in NVRAM
The IDPROM contents are invalid
</PRE>How can I fix this? <I>(Probably Replace chip)</I></LI>
<LI>The clock on my Sun has stopped working. When I turn off the machine it
loses track of the time and/or complains about invalid TOD when I turn it on.
How do I get my clock to keep time when the system is off? <I>(Replace chip)</I></LI>
<LI>I get warnings about by NVRAM battery being low when I boot my machine but
otherwise it works nicely. Should I be worried? <I>(Replace chip)</I></LI>
<LI>When my Sun boots I get warnings about the IDPROM checksum being incorrect
and/or <TT>Invalid format type in NVRAM</TT>. What does this mean and how can I
fix it?</LI>
<LI>The hostid and/or ethernet address on my Sun have been corrupted. How can I
restore it to a sane state? </LI>
<LI>How do I change the hostid and/or ethernet address of my Sun workstation?</LI>
<LI>My Sun is in full-security mode (can't even boot without password) and I
don't know the EEPROM password. How do I fix this? <I>(Replace chip)</I></LI></OL>
<P>The information in this document applies to the following Sun architectures:
sun4c, sun4m, sun4d, sun4u, sun3x (but not to sun4, sun3)</P>
<P>All of these questions relate to the NVRAM chip in the Sun workstation. The
contents of the NVRAM chip can become corrupted for a variety of reasons, most
commonly, failure of the embedded battery. The battery embedded in the NVRAM
chip keeps the clock running when the machine is off and also maintains
important system configuration information.  This FAQ tells you how to reprogram
your NVRAM chip and where to buy a new one, should you need to replace your
current NVRAM chip. If you have one of the questions marked <I>(Replace Chip)</I>,
you'll need to purchase a new NVRAM chip. The cost is about US$20. For the other
questions, as long as your machine retains its hostid and ethernet address when
turned off, and the clock keeps time when the machine is turned off,
reprogramming your NVRAM chip is enough.</P>
<P>One question is marked <I>(Probably Replace Chip)</I>. Usually, when the
NVRAM gets corrupted in this way, this  is a symptom that the battery embedded
in the NVRAM chip has run out and you need to replace the chip. If the machine
is relatively new, you should try reprogramming the NVRAM chip with a hostid and
ethernet address using the instructions below, then do a <KBD>reset</KBD> at
the &quot;ok&quot; prompt to make sure the banner looks as expected. Next turn
the machine off for a couple of minutes and turn it on again. If the machine
retains its hostid and ethernet address, then you probably don't need to replace
the NVRAM chip.</P>
<P>People can be asking two different questions when they are asking how to
change the ethernet address of a workstation. If you merely want to change the
ethernet address of an interface on your system, you can use the <KBD>ifconfig</KBD>
command and forget about the procedures in this document. The ethernet address
in NVRAM is the default address for all ethernet interfaces. If, for some
reason, you want to change this default ethernet address in NVRAM, then the
instructions in this document will tell you how to do this. Sun workstations are
a little strange in this regard, they don't get their MAC addresses from the
ethernet hardware itself.</P>
<P>The most up to date version of this document can be obtained from the
following sites:</P>
<UL>
<LI><A
HREF="ftp://ftp.mindlink.net/pub/crypto/sun-stuff/sun-nvram-hostid.faq.html">ftp://ftp.mindlink.net/pub/crypto/sun-stuff/sun-nvram-hostid.faq.html</A></LI>
<LI><A HREF="http://www.squirrel.com/squirrel/sun-nvram-hostid.faq.html">http://www.squirrel.com/squirrel/sun-nvram-hostid.faq.html</A></LI></UL>
<P>Plain text versions of this document are available from the following:</P>
<UL>
<LI><A HREF="ftp://ftp.mindlink.net/pub/crypto/sun-stuff/sun-nvram-hostid.faq">ftp://ftp.mindlink.net/pub/crypto/sun-stuff/sun-nvram-hostid.faq</A></LI>
<LI><A HREF="http://www.squirrel.com/squirrel/sun-nvram-hostid.faq">http://www.squirrel.com/squirrel/sun-nvram-hostid.faq</A></LI></UL>
<P>This FAQ is also distributed as part of a larger package for spoofing the
hostid on Sun workstations called
<A HREF="ftp://ftp.mindlink.net/pub/crypto/sun-stuff/change-sun-hostid.tar.gz">change-sun-hostid</A>.
In particular, parts of
<A HREF="ftp://ftp.mindlink.net/pub/crypto/sun-stuff/change-sun-hostid.tar.gz">change-sun-hostid</A>
can be used to modify the apparent hostid for some or all processes on a UNIX
system without messing with the NVRAM. This package even provides a way to make
a host seem to have multiple hostids (different processes see different
hostids). If you are interested in changing your hostid to deal with software
licence issues, you should probably try the scripts/programs in this package
first, as most of them don't make permanent changes to a chip on your
motherboard.  <A NAME="hidsites"></A>Changing the NVRAM should be a last
resort. You can retrieve this package from:</P>
<UL>
<LI><A
HREF="ftp://ftp.mindlink.net/pub/crypto/sun-stuff/change-sun-hostid.tar.gz">ftp://ftp.mindlink.net/pub/crypto/sun-stuff/change-sun-hostid.tar.gz</A></LI>
<LI><A
HREF="http://www.squirrel.com/squirrel/sun-stuff/change-sun-hostid.tar.gz">http://www.squirrel.com/squirrel/sun-stuff/change-sun-hostid.tar.gz</A></LI></UL>
<P>Some related links:</P>
<UL>
<LI><A
HREF="http://www.jaist.ac.jp/~kosmic/private/data/sparc_nvram_change.html">http://www.jaist.ac.jp/~kosmic/private/data/sparc_nvram_change.html</A>
is a Japanese language file with information on reprogramming and replacing the
NVRAM in a sun4c machine.</LI>
<LI><A HREF="http://www.portnet.co.jp/JIS/techical/WS/sunnvram.japanese.html">http://www.portnet.co.jp/JIS/techical/WS/sunnvram.japanese.html</A>
is a Japanese language eeprom-nvram FAQ</LI>
<LI>For other Sun Hardware questions, check out The Sun Hardware Reference
available from  <A HREF="ftp://ftp.picarefy.com/pub/Sun-Hardware-Ref">ftp://ftp.picarefy.com/pub/Sun-Hardware-Ref</A></LI>
<LI>For those who want more technical information about the NVRAM chips
themselves, SGS-Thomson has a WWW page with datasheets for the M48T02, M48T08,
and M48T59Y on <A HREF="http://www.st.com/">http://www.st.com</A></LI>
<LI>Useful tools for Sun Workstations at
<A HREF="http://www.squirrel.com/squirrel/sun-stuff.html">http://www.squirrel.com/squirrel/sun-stuff.html</A></LI></UL>
<P>This document consists of the following parts.</P>
<OL>
<LI><A HREF="#INTRO">Introduction and Hardware</A></LI>
<LI><A HREF="#GENERAL">General sun4c, sun4m, sun4d, sun4u IDPROM Programming</A></LI>
<LI><A HREF="#QUICK">A Quick-and-Dirty Guide to Restoring the NVRAM of a
sun4c/m/u Machine</A></LI>
<LI><A HREF="#3_80">The Sun 3/80</A></LI>
<LI><A HREF="#EG">Examples</A></LI>
<LI><A HREF="#ODDS">Odds and Ends</A>
<OL TYPE="a">
<LI><A HREF="#Reset">Resetting the NVRAM when Stop-N doesn't work</A></LI>
<LI><A HREF="#attach">Attaching a new battery onto an existing M48T02</A></LI>
<LI><A HREF="#clock">How to start and stop the NVRAM clock on the Sun 3/80 and
sun4c machines</A></LI>
<LI><A HREF="#arcane">Other more arcane methods for modifying the IDPROM</A></LI>
<LI><A HREF="#intel">The hostid on Solaris 2.5 x86</A></LI>
<LI><A HREF="#sun4">The NVRAM in sun4 architecture machines</A></LI>
<LI><A HREF="#classic">SparcClassic/Classic X NVRAM differences</A></LI>
<LI><A HREF="#enterprise">Enterprise Server NVRAM Programming</A></LI></OL></LI>
<LI><A HREF="#CREDITS">Credits</A></LI></OL>
<HR>
<P><A NAME="INTRO"></A></P>
<H1>Introduction and Hardware</H1>
<P>Every Sun 3/80, sun4c, sun4u, and sun4m architecture machine contains an
NVRAM chip (not to be confused with the NVRAM in Prestoserve). This NVRAM chip
stores various configuration parameters (e.g.  boot device, amount of RAM to
test), maintains the clock, and also contains the IDPROM data, which is composed
of the ethernet address, date of manufacture, hostid, a version number, and a
checksum.  The name IDPROM is historical.  On older machines such as the sun2,
sun3, and sun4 architecture machines the hostid and ethernet address were stored
in a PROM called the IDPROM.</P>
<P>The sun4d machines (e.g. SS1000) also have an NVRAM chip. However, the
IDPROM information is stored in a flash EEPROM and is downloaded into the NVRAM
during POST. You can also upload the IDPROM information from the NVRAM chip to
the flash EEPROM,  so you can change the value of IDPROM in the flash EEPROM by
merely changing the NVRAM and uploading the new values.</P>
<P>This document is for people who want to accomplish one of the following
tasks:</P>
<UL>
<LI>Install a new NVRAM chip in a Sun 3/80, sun4c, or sun4m machine. Usually
this will be due to NVRAM failure or loss of the NVRAM password in full security
mode.</LI>
<LI>Change the hostid/ethernet address of a Sun 3/80, sun4c, sun4m, sun4u or
sun4d machine.</LI>
<LI>Restore a machine with a corrupted NVRAM chip in a Sun 3/80, sun4c, sun4u,
sun4m machine to working order.</LI></UL>
<P>I'm going to focus on methods that involve reprogramming the chip from the
FORTH OpenBoot monitor (&quot;ok&quot; prompt).  The OpenBoot monitor uses a
modified version of FORTH, which is a language similar to that used on the HP
calculators which use RPN. You don't need to know any FORTH to reprogram your
IDPROM, but the instructions below might make a little more sense if you do know
some FORTH.</P>
<P>The NVRAM chip will usually have a white or yellow barcode label on it
(except for sun4d). Given the barcode, Sun can reconstruct your original hostid
and ethernet address. On newer machines (some SS5, SS20, all Ultras) the number
printed on the barcode is the last three bytes of the ethernet address and also
the last three bytes of the hostid. The first three bytes of the ethernet
address are always 8:0:20 and the first byte of the hostid is determined by the
system type (<A HREF="#SYSTBL">see table below</A>), so on these machines you
can trivially reconstruct the hostid. I have no idea how to do it on the
machines with the old style barcode label, but if nothing else, the label makes
the NVRAM chip easy to identify.<A HREF="#GIF"></A></P><IMG
ALIGN="MIDDLE" SRC="sun-nvram.gif">
<P>The following table gives the location of the NVRAM chip for various models
of Sun workstation.</P>
<TABLE BORDER="1" ALIGN="CENTER">
<TR>
<TD WIDTH="250">3/80</TD>
<TD>U0205</TD></TR>
<TR>
<TD>4/60 (SS1)</TD>
<TD>U089</TD></TR>
<TR>
<TD>4/40 (IPC)</TD>
<TD>U0901</TD></TR>
<TR>
<TD>4/65 (SS1+)</TD>
<TD>U089</TD></TR>
<TR>
<TD>4/20 (SLC)</TD>
<TD>U1011</TD></TR>
<TR>
<TD>4/25 (ELC)</TD>
<TD>U0813</TD></TR>
<TR>
<TD>4/50 (IPX)</TD>
<TD>U0512</TD></TR>
<TR>
<TD>4/75 (SS2)</TD>
<TD>U0512</TD></TR>
<TR>
<TD>4E</TD>
<TD>U1101</TD></TR>
<TR>
<TD>4/10 (SPARCclassic X)</TD>
<TD>U0707</TD></TR>
<TR>
<TD>4/15 (SPARCclassic)</TD>
<TD>U0707</TD></TR>
<TR>
<TD>4/30 (LX/ZX)</TD>
<TD>U0707</TD></TR>
<TR>
<TD>SPARC Xterm 1</TD>
<TD>U1605</TD></TR>
<TR>
<TD>SS4</TD>
<TD>U1605</TD></TR>
<TR>
<TD>SS5</TD>
<TD>U1506</TD></TR>
<TR>
<TD>SS10</TD>
<TD>U1004</TD></TR>
<TR>
<TD>SS20</TD>
<TD>U1004</TD></TR>
<TR>
<TD>SS600MP</TD>
<TD>U2701</TD></TR>
<TR>
<TD>SS240 (Voyager)</TD>
<TD>U1506</TD></TR>
<TR>
<TD>SS1000/1000E</TD>
<TD>U1007</TD></TR>
<TR>
<TD>SS2000/2000E</TD>
<TD>U1205</TD></TR>
<TR>
<TD>U1/170</TD>
<TD>U2006</TD></TR></TABLE>
<P>The NVRAM chips are SGS-Thomson Timekeeper (formerly Mostek) chips. They
contain an embedded battery with a fixed life. When the machine is off, the
battery runs down.  It is very common for the battery embedded in the Timekeeper
chip in an older Sun (sun4c, sun3x) to fail. The following table lists the NVRAM
chip type by machine architecture:</P>
<TABLE BORDER="BORDER">
<TR>
<TD WIDTH="120">sun4c</TD>
<TD>M48T02</TD></TR>
<TR>
<TD>sun4m</TD>
<TD>M48T08/18</TD></TR>
<TR>
<TD>sun4d</TD>
<TD>M48T08</TD></TR>
<TR>
<TD>sun4u</TD>
<TD>M48T59Y</TD></TR>
<TR>
<TD>sun3x</TD>
<TD>M48T02</TD></TR></TABLE>
<P>The NVRAM chips used to be designated Mostek MK48T02 etc. These chips come
in various speeds. The newer SGS-Thomson part numbers are M48T02-200PC1 for the
200ns M48T02, M48T08-100PC1 for the 100ns M48T08. 200ns is adequate for any Sun,
but often the faster chips are easier to come by, and there is no harm in buying
them. If you have trouble tracking down a local SGS-Thomson distributor, Mouser
electronics sells the SGS-Thomson Timekeeper chips (telephone: 800.346.6873, 
+1.817.483.5712).
You can also order from Mouser on the web at
<A HREF="http://www.mouser.com/">http://www.mouser.com/</A>.
The Mouser stock numbers as of 1995 are slighly different than the usual 
part numbers and are as follows:</P>
<TABLE>
<TR>
<TD>SGS-Thomson part</TD>
<TD>Mouser stock number</TD>
<TD>speed</TD>
<TD>capacity</TD></TR>
<TR>
<TD><TT>M48T02-200PC1 </TT></TD>
<TD><TT>511-M48T0220PC1</TT></TD>
<TD><TT>200ns </TT></TD>
<TD><TT>2kB</TT></TD></TR>
<TR>
<TD><TT>M48T02-150PC1</TT></TD>
<TD><TT>511-M48T0215PC1 </TT></TD>
<TD><TT>150ns</TT></TD>
<TD><TT>2kB</TT></TD></TR>
<TR>
<TD><TT>M48T02-120PC1
</TT></TD>
<TD><TT>511-M48T0212PC1 </TT></TD>
<TD><TT>120ns</TT></TD>
<TD><TT>2kB</TT></TD></TR>
<TR>
<TD><TT>M48T08-150PC1</TT></TD>
<TD><TT>511-M48T0815PC1</TT></TD>
<TD><TT>150ns</TT></TD>
<TD><TT>8kB</TT></TD></TR>
<TR>
<TD><TT>M48T08-100PC1</TT></TD>
<TD><TT>511-M48T0810PC1</TT></TD>
<TD><TT>100ns</TT></TD>
<TD><TT>8kB</TT></TD></TR>
<TR>
<TD><TT>M48T59Y-70PC1</TT></TD>
<TD><TT>511-M48T59Y70PC1</TT></TD>
<TD><TT> 70ns</TT></TD>
<TD><TT>8kB</TT></TD></TR></TABLE>
<P>As of Oct 1995, the prices for these chips from Mouser range from
US$16.00-23.12.  I have no affiliation with Mouser other than as a customer.</P>
<P>Dallas Semicondutor makes a clone of the SGS-Thomson M48T02 chips, the
DS1642.  I've had mixed experience using the Dallas chips in a Sun. My
experience is that these chips do <STRONG>not</STRONG> work properly in the
following machines:  3/80, SS2, IPX (they fail POST, but otherwise seem OK).
However, the Dallas chips are reported to work in the following machines: SS1, 
SS1+, IPC.  I have no idea whether the Dallas chips work properly in the
following:  SLC, ELC. You can order the DS1642 chips in 120ns or 150ns speeds
(150ns is fine) directly from Dallas in quantities up to 10 by calling
1-800-336-6933 and giving Dallas a credit card number.  Data sheets and
distrubutor lists for Dallas are available from
<A HREF="http://www.dalsemi.com/">http://www.dalsemi.com/</A>. Stanislav
Sinyagin &lt;stas@isf.ru&gt; reports that the M48T12 is another acceptable
alternative for the SS1.</P>
<P>Here are some other sources for M48T02/8/18 chips (if you know of sources
not listed here, please <A HREF="mailto:mch@squirrel.com">send me email</A>).
Any SGS-Thomson distributor that will sell the chips in small quantities should
do. There is a list of SGS-Thomson distributors at
<A HREF="http://us.st.com/stonline/address/distrib/">http://us.st.com/stonline/address/distrib/</A>.
Thanks to simonallen@cix.compulink.co.uk, Kenji Oshima &lt;kosmic@jaist.ac.jp&gt;,
Michael J C Firth &lt;mfirth@visual.bt.co.uk&gt;, Bernd Wagner &lt;bwagner@applix.de&gt;,
Werner Lappessen &lt;wlappess@ford.com&gt;, Mikael Bergqvist &lt;mbq@aronnax.physto.se&gt;,
Klaus Koehnlein &lt;klaus.koehnlein@uni-tuebingen.de&gt;, NoRM &lt;norm@mono.org&gt;,
H Richardson &lt;harvey@tromba.demon.co.uk&gt;, Jon Laughton &lt;jon@eoin.demon.co.uk&gt;,
Jill Holliday &lt;jill@lynxuk.demon.co.uk&gt;  for sending me the sources I have
here:</P>
<UL>
<LI>Farnell Electronic Components  (Tel: 01132 636311) in the U.K. </LI>
<LI>Maplin Electronics (Tel: 01702 554161) in the U.K. Maplin part number
DC01B. Price as of Jan 1998 was GBP 18.99</LI>
<LI>CPC in the U.K. Tel: 01772 654455. Ask for a service called &quot;Part
Finder&quot;. Price as of July 1997 was GBP 12.92</LI>
<LI><A NAME="JAPAN"></A>Wakamatsu Tsusho Parts Shop, Mitsuwa Budg. 2F, 1-11-4
Soto-kanda, Chiyoda-ku, Tokyo 101 Japan tel. (+81)3-3251-4121 / fax.
(+81)3-3251-7877</LI>
<LI>Jermyn GmbH, Im Dachstueck 6, D-65449 Limburg, phone in Germany : 06431
5080</LI>
<LI>MSC-Vertriebs GmbH, Industriestr. 16, D-76297 Stutensee, Tel. +49 (0)72 49
91 00, Fax +49 (0)72 49 79 93 (price as of July 1997 about DM 25)</LI>
<LI>elpro, Am Kreuzer 13, D-64372 Ober-Ramstadt, phone in Germany :
06154/63570, fax: 06154/635749, email elpro@t-online.de</LI>
<LI>ELFA (<A HREF="http://www.elfa.se/">http://www.elfa.se/</A>) is a Swedish
company with branch offices in Norway, Denmark, and Finland. Part number for the
M48T02 is 73-712-06 (part name in catalogue: M48T02B-15/ST) and the cost is Skr
182 (excluding VAT) as of April 1997. Phone numbers:
<UL>
<LI>Sweden  Order:  +46 (0)8 735 35 35, Info 735 35 15</LI>
<LI>Finland Order: 08001 11 827</LI>
<LI>Denmark Order: 8001 20 02</LI>
<LI>Norway  Order: 800 10 135</LI></UL></LI></UL>
<HR>
<P><A NAME="GENERAL"></A></P>
<H1>General sun4c, sun4m, sun4d, sun4u IDPROM Programming</H1>
<P>If you have a valid NVRAM chip installed (IDPROM is ok) then before doing
anything else, write down a copy of the IDPROM information. You can get it under
Sun OS 4.1.x by running <KBD>/usr/etc/devinfo -vp</KBD> or under Solaris 2.x by
executing <KBD>/usr/sbin/prtconf -vp</KBD>. Alternatively you can get the
IDPROM information at the OpenBoot monitor &quot;ok&quot; prompt by typing the
command <KBD>.idprom</KBD> (yes the &quot;.&quot; is part of the command).
You'll need this information if the NVRAM gets screwed up and you need to try
and back out.</P>
<H2>Step 1.</H2>
<P>Go to the OpenBoot monitor (ok prompt). You can do this by turning on your
machine, pressing L1/Stop-A to interrupt the boot sequence, and entering &quot;new
command mode&quot;. Alternatively, if your machine is running, just shut down
your operating system.</P>
<P>If you are installing a new NVRAM type <KBD>set-defaults</KBD> followed by
the <KBD>&lt;Enter&gt;</KBD> key and then <KBD>setenv diag-switch? false</KBD>
followed by the <KBD>&lt;Enter&gt;</KBD> key.</P>
<P>Generally a machine will reset the NVRAM to the default values (excluding
the IDPROM information) when it detects a new NVRAM. Still, it is good to do a
<KBD>set-defaults</KBD> just in case this fails.</P>
<H2>Step 2.</H2>
<P>The command to reprogram the IDPROM part of NVRAM is &quot;mkp&quot;. The
format for the command is</P>
<P><KBD>&lt;value&gt; &lt;location&gt; mkp</KBD></P>
<P>where location is read off the following table (all values are in
hexadecimal). Note that some Sun clones (e.g. Tatung COMPstation 25 with TWS
boot PROM REV 1.7) don't have an &quot;mkp&quot; command. If  &quot;mkp&quot;
doesn't work on your system, see the section below entitled <A HREF="#arcane">Other
more arcane methods for modifying the IDPROM</A>.</P>
<TABLE>
<TR>
<TD WIDTH="90">byte(s)</TD>
<TD>contents</TD></TR>
<TR>
<TD><TT>0</TT></TD>
<TD>always 01 - format/version number</TD></TR>
<TR>
<TD><TT>1</TT></TD>
<TD>first byte of hostid (machine type)</TD></TR>
<TR>
<TD><TT>2-7</TT></TD>
<TD>6 byte ethernet address (first three bytes should be 08,00,20)</TD></TR>
<TR>
<TD><TT>8-b</TT></TD>
<TD>date of manufacture (usually all 0s, doesn't really matter)</TD></TR>
<TR>
<TD><TT>c</TT></TD>
<TD>second byte of hostid</TD></TR>
<TR>
<TD><TT>d</TT></TD>
<TD>third byte of hostid</TD></TR>
<TR>
<TD><TT>e</TT></TD>
<TD>fourth byte of hostid</TD></TR>
<TR>
<TD><TT>f</TT></TD>
<TD>IDPROM checksum - bitwise xor of bytes 0-e</TD></TR></TABLE>
<P>As mentioned above, you can look at the complete idprom by executing <KBD>.idprom</KBD>.
Bytes c through e in the table above are collectively referred to as the serial
number. If you convert the concatenation of bytes c-e to decimal, this is the
serial number you see when you turn the machine on.</P>
<P>Alternatively, you can use  the <KBD>idprom@</KBD> command to get a
particular byte from the IDPROM</P>
<P><KBD>&lt;location&gt; idprom@</KBD></P>
<P>returns the IDPROM value of byte <KBD>&lt;location&gt;</KBD></P>
<P>so</P>
<P><KBD>&lt;location&gt; idprom@ .</KBD></P>
<P>prints the IDPROM value of byte <KBD>&lt;location&gt;</KBD> because <KBD>.</KBD>
is the FORTH command to print the value on the bottom of the stack.</P>
<P>Now make the changes using mkp. Be very careful and be sure to compute the
checksum after making changes. If you don't, you'll get nasty warnings about an
incorrect IDPROM checksum on boot. A quick and dirty way to compute and store
the checksum in location f is to execute the following at the &quot;ok&quot;
prompt _after_ you have made your changes to locations 0-e.</P>
<P><KBD>0 f 0 do i idprom@ xor loop f mkp</KBD></P>
<P>Don't change the first byte of the hostid to something that doesn't
correspond to your system type (<A HREF="#SYSTBL">see table below</A>).
Similarly, the first three bytes of the ethernet address should be (08,00,20).
The first byte of the hostid is often used to determine the architecture when
booting from CDROM on some Sun models. If you don't set the first three bytes of
the ethernet address to 08,00,20 you might get message which says that you have
a defective motherboard (but then I don't know of any other consequences of
changing this to some reasonable value, especially avoid ff:ff:ff:ff:ff:ff !. On
some systems you can get away with changing the first three bytes of the
ethernet address to more or less anything you want).</P>
<P>If you'd rather not use the table below, you can find out what you should
make the first byte of the hostid by typing <KBD>real-machine-type .</KBD> at
the &quot;ok&quot; prompt.  Note that <KBD>real-machine-type</KBD> may not be
defined on some machines with older boot proms.</P>
<P>e.g.  modify the hostid of an IPX to be 57c0ffee and the ethernet address to
be 08:00:20:c0:ff:ee. At the OpenBoot monitor prompt (ok)</P>
<PRE>1 0 mkp
real-machine-type 1 mkp
8 2 mkp
0 3 mkp
20 4 mkp
c0 5 mkp
ff 6 mkp
ee 7 mkp
0 8 mkp
0 9 mkp
0 a mkp
0 b mkp
c0 c mkp
ff d mkp
ee e mkp
0 f 0 do i idprom@ xor loop f mkp
</PRE>
<H2>Step 3.</H2>
<P>If you are on an SS1000, type <KBD>update-system-idprom</KBD> at the
OpenBoot PROM &quot;ok&quot;  prompt.</P>
<P>For any of the above machines, now type reset at the ok prompt. Your machine
should then attempt to reboot with your new hostid/enet addr.</P>
<P><A NAME="SYSTBL"></A></P>
<TABLE>
<CAPTION>The following table matches Sun system models with the first byte of
the hostid. This is from a posting to comp.sys.sun.admin by
Andy.Behrens@coat.com</CAPTION>
<TR>
<TD>01</TD>
<TD>2/1x0</TD></TR>
<TR>
<TD>02</TD>
<TD>2/50</TD></TR>
<TR>
<TD>11</TD>
<TD>3/160</TD></TR>
<TR>
<TD>12</TD>
<TD>3/50</TD></TR>
<TR>
<TD>13</TD>
<TD>3/2x0</TD></TR>
<TR>
<TD>14</TD>
<TD>3/110</TD></TR>
<TR>
<TD>17</TD>
<TD>3/60</TD></TR>
<TR>
<TD>18</TD>
<TD>3/e</TD></TR>
<TR>
<TD>21</TD>
<TD>4/2x0</TD></TR>
<TR>
<TD>22</TD>
<TD>4/1x0</TD></TR>
<TR>
<TD>23</TD>
<TD>4/3x0</TD></TR>
<TR>
<TD>24</TD>
<TD>4/4x0</TD></TR>
<TR>
<TD>31</TD>
<TD>386i</TD></TR>
<TR>
<TD>41</TD>
<TD>3/4x0</TD></TR>
<TR>
<TD>42</TD>
<TD>3/80</TD></TR>
<TR>
<TD>51</TD>
<TD>SPARCstation 1 (4/60)</TD></TR>
<TR>
<TD>52</TD>
<TD>SPARCstation IPC (4/40)</TD></TR>
<TR>
<TD>53</TD>
<TD>SPARCstation 1+  (4/65) </TD></TR>
<TR>
<TD>54</TD>
<TD>SPARCstation SLC (4/20)</TD></TR>
<TR>
<TD>55</TD>
<TD>SPARCstation 2 (4/75)</TD></TR>
<TR>
<TD>56</TD>
<TD>SPARCstation ELC </TD></TR>
<TR>
<TD>57</TD>
<TD>SPARCstation IPX (4/50) </TD></TR>
<TR>
<TD>61</TD>
<TD>4/e</TD></TR>
<TR>
<TD>71</TD>
<TD>4/6x0</TD></TR>
<TR>
<TD>72</TD>
<TD>SPARCstation 10 or SPARCstation 20</TD></TR>
<TR>
<TD>80 </TD>
<TD>SPARCstation Classic, LX, 4, 5, SS1000, Voyager, Ultra 1</TD></TR></TABLE>
<HR>
<P><A NAME="QUICK"></A></P>
<H1>A Quick-and-Dirty Guide to Restoring the NVRAM of a sun4c/m/u machine</H1>
<P>This is for folks who need to replace their NVRAM chip in a sun4c/m/u
machine and don't want to bother with XOR calculations or the details above with
<KBD>mkp</KBD>. I am assuming that you have a brand new NVRAM chip in hand. All
numbers below are in hex.</P>
<P>First, decide what ethernet address you want to use and what you want for
the last three byte of the hostid. The ethernet address should begin with
08:00:20. There are no restrictions on the last three bytes of the hostid. Say
the ethernet address is 08:00:20:E3:E4:E5 and the last three bytes of the hostid
are H1, H2, H3. The first byte of the hostid will automatically be set according
to the system type (<KBD>real-machine-type</KBD> variable in the OpenBoot
monitor).</P>
<P>Turn off the machine. Remove the old NVRAM chip after noting the
orientation.  Insert the new NVRAM chip. Be sure to insert it in the correct
orientation, as installing it in the wrong orientation and powering on the
machine will generally destroy the chip. Power up the machine and bring it to
the &quot;ok&quot; prompt. At the &quot;ok&quot; prompt execute the following</P>
<P></P>
<PRE>set-defaults
setenv diag-switch? false
8 0 20 E3 E4 E5 H1H2H3 mkpl</PRE>
<P><KBD>mkpl</KBD> expects some input (but it doesn't prompt you). The input
is a <KBD>Control-D</KBD> followed by a <KBD>Control-R</KBD>. If mkpl does
<STRONG>not
</STRONG>print a copyright notice, then it changed the IDPROM.  You should make
sure by looking at the idprom after using <KBD>mkpl</KBD> by executing  the
<KBD>.idprom</KBD>command</P>
<P>e.g. <KBD>8 0 20 13 de ad c0ffee mkpl</KBD> will set the last three bytes
of the hostid to c0ffee and the ethernet address to 08:00:20:13:de:ad.</P>
<P><EM>N.B.</EM> <KBD>mkpl</KBD> will only work if the IDPROM checksum is
<B>invalid</B>. Otherwise it will simply print a copyright notice after you
type the Control-R.  So, if you can't get <KBD>mkpl</KBD> to work, you can try
making the IDPROM checksum invalid. You can invalidate the IDPROM checksum in an
NVRAM with a valid IDPROM checksum by executing <KBD>f idprom@ 1 xor f mkp</KBD>
(it seems that invalidating the version number will also do, e.g.
<KBD>17 0 mkp</KBD>). If you still can't get <KBD>mkpl</KBD> to work, then you
should try using
<KBD>mkp</KBD> as described in the <A HREF="#GENERAL">above section.</A> This
note was added because on some machines, <KBD>set-defaults</KBD> will set the
IDPROM checksum according to the other values in the IDPROM.</P>
<HR>
<P><A NAME="3_80"></A></P>
<H1>The Sun 3/80.</H1>
<P>Here's a way to modify NVRAM IDPROM info on a Sun 3/80 (people have to do
this because of the usual battery problem, as with the sun4c machines) This may
not be the most elegant procedure, but this should allow you to modify the NVRAM
IDPROM info on a sun 3/80. At first glance you might think that the <KBD>q</KBD>
command would work, but it doesn't seem to actually modify anything when given
addresses &gt;= 0x7d8</P>
<P>Press <KBD>Stop-A</KBD> after you turn the 3/80 on</P>
<P><EM>N.B.:</EM><KBD>^t</KBD> is a command in the steps below. Don't try
<KBD>control-T</KBD>. This procedure has only been tested with 2.9.2 PROMS.</P>
<OL>
<LI>At the <KBD>&gt;</KBD> prompt execute the command <KBD>^t fef04000</KBD>.
You'll get output which includes the following (samples included)
<PRE>TIA entry = 33FA500
TIB entry = 33FB80A
PTE=64000049
</PRE>Write these values down.</LI>
<LI>Change the TIA entry for <KBD>fedfa000</KBD> to match the above
<PRE>&gt; m a fedfa000
TIA MAP FEDFA000 [...] ? 33FA500
</PRE>Type <KBD>Control-D</KBD> at the next <KBD>?</KBD> prompt</LI>
<LI>Change the TIB entry to match the above:
<PRE>&gt; m b fedfa000
TIB MAP FEDFA000 [...] ? 33FB80A
</PRE></LI>
<LI>Now change the pagemap entry to match the above
<PRE>p fedfa000
PageMap FEDFA000 [...] ? 64000049
</PRE></LI>
<LI>Now enter the new IDPROM values. Use the following table and be sure to get
the checksum right.
<PRE>o fedfa7d8
...

</PRE>
<P>Jay York &lt;jyork@smart.net&gt; has provided me with a great simplification
of the above procedure that I have been unable to test. His procedure skips the
steps preceeding this last step (<KBD>o fedfa7d8</KBD>). Instead, one can
simply do <KBD>o fef047d8</KBD> and enter the IDPROM values at that point. I am
leaving the more involved procedure above, because I don't have a 3/80 to test
this simplified procedure.</P>
<TABLE BORDER="BORDER" CELLSPACING="3">
<CAPTION>Sun 3/80 IDPROM</CAPTION>
<TR>
<TD>byte</TD>
<TD>contents</TD></TR>
<TR>
<TD><TT>fedfa7d8</TT></TD>
<TD><TT>01</TT></TD></TR>
<TR>
<TD><TT>fedfa7d9</TT></TD>
<TD><TT>42</TT></TD></TR>
<TR>
<TD><TT>fedfa7da-7df</TT></TD>
<TD>6 byte ethernet address (first three bytes must be <TT>08,00,20</TT>)</TD></TR>
<TR>
<TD><TT>fedfa7e0-7e3</TT></TD>
<TD>date of manufacture (all 0s is fine)</TD></TR>
<TR>
<TD><TT>fedfa7e4</TT></TD>
<TD>second byte of hostid</TD></TR>
<TR>
<TD><TT>fedfa7e5</TT></TD>
<TD>third byte of hostid</TD></TR>
<TR>
<TD><TT>fedfa7e6</TT></TD>
<TD>fourth byte of hostid</TD></TR>
<TR>
<TD><TT>fedfa7e7</TT></TD>
<TD>checksum - bitwise xor of bytes at <TT>fedfa7d8-fedfa7e6</TT></TD></TR></TABLE></LI>
<LI>Reset the computer by executing the command <KBD>k 2</KBD>. It should come
back up with the desired hostid and ethernet address. </LI>
<LI>If you are installing a new M48T02 chip, you'll also need to initialise the
other values in NVRAM, e.g. boot device, memory, etc. Unlike the sun4c machines,
the Sun 3/80 does not set these parameters to sane defaults when it detects a
new M48T02. To modify the rest of NVRAM you can use the <KBD>q</KBD> command in
the monitor. <A HREF="#SUN3TBL">See the table below.</A></LI></OL>
<P>When Sun OS 4.1.x boots, it will kick-start the clock. The first time it
boots it will complain that the TOD is not initialized. It shouldn't complain
the second time the machine boots. However, if you are using Sun OS 4.1 a bug
that was fixed in 4.1.1 will prevent the OS from being able to use the NVRAM
clock. One can fix this. change the line in /usr/include/sun3x/devaddr.h and
/usr/kvm/sys/sun3x/devaddr.h from</P>
<P><KBD>#define V_CLK1ADDR   0xFEDFC7F8</KBD></P>
<P>to</P>
<P><KBD>#define V_CLK1ADDR   0xFEDFA7F8</KBD></P>
<P>and then patching the kernel by searching for 0xFEDFC7F8 in the kernel and
changing it to be 0xFEDFA7F8. Thanks to simonallen@cix.compulink.co.uk for this
information.</P>
<P>The following table of memory locations in NVRAM for the Sun 3 series
machines is from the Sun Hardware Reference by James W. Birdsall &lt;jwbirdsa@picarefy.com&gt;.
I provide it here so you won't have to dig up the Sun Hardware Reference to
restore a 3/80 to working order. I've omitted a few rows that have nothing to do
with the 3/80 (mostly 386i stuff)</P>
<P><A NAME="SUN3TBL"></A></P>
<TABLE BORDER="BORDER" CELLPADDING="5" CELLSPACING="5">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x14</TD>
<TD COLSPAN="3">Installed memory in MB.</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x15</TD>
<TD COLSPAN="3">Tested memory in MB</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="5">0x16</TD>
<TD ROWSPAN="5">Monitor screen size</TD>
<TD>0x00
</TD>
<TD>1152x900 (standard resolution)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>1024 x 1024</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x13</TD>
<TD>1600 x 1280</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x14</TD>
<TD>1440 x 1440</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x15</TD>
<TD>1024  x 768</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x17</TD>
<TD ROWSPAN="2">Watchdog reset action</TD>
<TD>0x00</TD>
<TD>invoke ROM monitor</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12 </TD>
<TD>initate power-on reset (default)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x18</TD>
<TD ROWSPAN="2">Boot device</TD>
<TD>0x00</TD>
<TD>poll (default)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>boot from EEPROM/NVRAM specified boot device</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="6">0x19-0x1a</TD>
<TD ROWSPAN="6">SunOS boot device name (in ASCII)</TD>
<TD>0x78 0x79</TD>
<TD>xy</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x78 0x64</TD>
<TD>xd</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x73 0x64</TD>
<TD>sd</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x69 0x65 </TD>
<TD>ie</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x69 0x64</TD>
<TD>id</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x6c 0x65</TD>
<TD>le</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x1b-0x1d</TD>
<TD>SunOS boot device controller, unit, partition numbers</TD>
<TD>0x00 0x00 0x00</TD>
<TD>(0,0,0) (default)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="5">0x1f</TD>
<TD ROWSPAN="5">Primary terminal</TD>
<TD>0x00</TD>
<TD>monochrome FB</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x10</TD>
<TD>serial port A</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x11</TD>
<TD>serial port B</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12 </TD>
<TD>0x12 VMEbus and 3/60-P4 color frame buffers (configure locations
0x60c-0x613 when VX and MVX graphics options are installed)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x20</TD>
<TD>non-3/60 P4 color frame buffer</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x20</TD>
<TD ROWSPAN="2">Power-up banner</TD>
<TD>0x00</TD>
<TD>Sun logo display</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>custom banner stored in 0x68-0xb7</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x21</TD>
<TD ROWSPAN="2">Keyboard click</TD>
<TD>0x00</TD>
<TD>off</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>on</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x22-23</TD>
<TD>Diagnostic boot device name (in ASCII)</TD>
<TD COLSPAN="2">Used when NORM/DIAG switch is in DIAG position. On the 3/80
there isn't a switch, NORM/DIAG mode is controlled by location 0x70b. As in
0x1b-0x1d or 0x00, 0x00 to invoke the PROM monitor</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x24-0x26</TD>
<TD COLSPAN="3">Diagnostic boot device controller, unit, partition number</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x28-0x4f</TD>
<TD>Diagnostic boot path </TD>
<TD COLSPAN="2">Used when in DIAG mode. ASCII codes for path and filename to
boot, or all zeros to invoke ROM monitor</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x50 </TD>
<TD COLSPAN="3">High resolution number of columns</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x51</TD>
<TD COLSPAN="3">High resolution number of rows</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x58</TD>
<TD ROWSPAN="2">Serial port A default baud rate</TD>
<TD>0x00</TD>
<TD>9600</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>use rate stored at 0x59-0x5a</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x59-0x5a</TD>
<TD>Serial port A baud rate</TD>
<TD COLSPAN="2">The baud rate as a 16-bit number, MSB first (e.g. 0x04 0xb0 for
1200)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x5b</TD>
<TD ROWSPAN="2">Serial port A DTR/RTS</TD>
<TD>0x00</TD>
<TD>assert DTR and RTS</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>do not assert DTR and RTS</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x60</TD>
<TD ROWSPAN="2">Serial port B default baud rate</TD>
<TD>0x00</TD>
<TD>9600</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>use rate stored at 0x61-0x62. Note that when in DIAG mode, port B runs at
1200 baud and the settings in 0x60-0x62 are ignored</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x61-0x62</TD>
<TD>Serial port B baud rate</TD>
<TD COLSPAN="2">The baud rate as a 16-bit number, MSB first (e.g. 0x04 b0 for
1200)</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="2">0x63</TD>
<TD ROWSPAN="2">Serial port B DTR/RTS</TD>
<TD>0x00</TD>
<TD>assert DTR and RTS</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>do not assert DTR and RTS</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x68-0xb7</TD>
<TD>Custom banner</TD>
<TD COLSPAN="2">ASCII codes for desired banner, padded with spaces and ending
with 0x0D, 0x0A in locations 0xB6 and 0xB7</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="3">0x18f</TD>
<TD ROWSPAN="3">Logo type</TD>
<TD>0x00</TD>
<TD>normal Sun logo</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x06</TD>
<TD>3D logo for CG6</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>custom logo</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="3">0x492</TD>
<TD ROWSPAN="3">Password mode select</TD>
<TD>0x01</TD>
<TD>command secure mode</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x5e</TD>
<TD>fully secure mode</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>other</TD>
<TD>non-secure mode</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x493-a</TD>
<TD>Password</TD>
<TD COLSPAN="2">Eight bytes of password in ASCII. If the ROM is 2.8, enter a
'@' character before each letter of the password. Enter one letter per location,
followed by Return. If the password is less than eight letters, enter 0x00 in
the remaining locations. The hexadecimal values of the letters can also be used
to enter the password.
</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ROWSPAN="3">0x70b</TD>
<TD ROWSPAN="3">3/80 power-on mode</TD>
<TD>0x06</TD>
<TD>normal boot</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>0x12</TD>
<TD>diagnostic boot</TD></TR>
<TR>
<TD>other</TD>
<TD>diagnostic boot</TD></TR></TABLE>
<HR>
<P><A NAME="EG"></A></P>
<H1>Examples</H1>
<P><EM>N.B. As I said above, you should be careful that the first byte of the
hostid matches the system type.</EM></P>
<OL>
<LI>Modify the hostid of an IPX to be 57c0ffee and the ethernet address to be
08:00:20:c0:ff:ee. At the OpenBoot PROM monitor prompt
<PRE>01 0 mkp
57 1 mkp
08 2 mkp
0 3 mkp
20 4 mkp
c0 5 mkp
ff 6 mkp
ee 7 mkp
57 8 mkp
0 9 mkp
0 a mkp
0 b mkp
c0 c mkp
ff d mkp
ee e mkp
29 f mkp
</PRE>Notice the simplification in the above example. If you make the ethernet
address 08:00:20:H1:H2:H3 and the four bytes of the hostid ST,H1,H2,H3 where ST
is the system type byte, and you put ST,0,0,0 in the date of manufacture field,
then the IDPROM checksum will always be 29 (remember all of these numbers are
hexadecimal). This make things a bit easier, you can, in general, just enter
<PRE>01 0 mkp
real-machine-type 1 mkp
08 2 mkp
0 3 mkp
20 4 mkp
H1 5 mkp
H2 6 mkp
H3 7 mkp
real-machine-type 8 mkp
0 9 mkp
0 a mkp
0 b mkp
H1 c mkp
H2 d mkp
H3 e mkp
29 f mkp
</PRE>and you don't need to calculate the checksum since it will always be 0x29.</LI>
<LI>Change the hostid of an SS10 to be 72c0ffee and the ethernet address to be
08:00:20:c0:ff:ee.
<PRE>01 0 mkp
72 1 mkp
08 2 mkp
0  3 mkp
20 4 mkp
c0 5 mkp
ff 6 mkp
ee 7 mkp
0 8 mkp
0 9 mkp
0 a mkp
0 b mkp
c0 c mkp
ff d mkp
ee e mkp
0 f 0 do i idprom@ xor loop f mkp
</PRE></LI>
<LI>Change the hostid of an SS1000 to 80c0ffee. Leave the ethernet address and
the date of manufacture intact. Note that the system type byte for the SS1000 is
0x80
<PRE>c0 c mkp
ff d mkp
ee e mkp
0 f 0 do i idprom@ xor loop f mkp
update-system-idprom
</PRE></LI>
<LI>Install a new NVRAM in an IPX. Set the hostid to 57c0ffee and the ethernet
address to be 08:00:20:c0:ff:ee .
<OL>
<LI>Turn the machine off.</LI>
<LI>Remove the old NVRAM chip</LI>
<LI>Install the new NVRAM chip. Be sure to get the orientation right.</LI>
<LI>Turn the machine on.</LI>
<LI>At the OpenBoot monitor prompt execute the following commands:
<PRE>set-defaults
setenv diag-switch? false
8 0 20 c0 ff ee c0ffee mkpl
^D^R
</PRE> where <KBD>^D</KBD> represents <KBD>Control-D</KBD>, etc.</LI></OL></LI></OL>
<HR>
<P><A NAME="ODDS"></A></P>
<H1>Odds and Ends.</H1>
<H2><A NAME="Reset"></A>Resetting the NVRAM (when Stop-N doesn't do it)</H2>
<P>You might want to do this to recover from the loss of an NVRAM password (in
full security mode) or if you mess up your nvramrc. I think that the safest
thing to do is pay the $20 for a new Timekeeper chip. But several people have
reported to me success hot-swapping the NVRAM (i.e. removing and installing a
new chip when the system is on).</P>
<PRE>dowdy@cs.colorado.edu (Stephen Dowdy) writes:
&gt; (this may apply to other SPARC models.)
&gt; IPC --  remove NVRAM, power-up without.  *carefully* hot-plug it in when OK
&gt;     prompt comes up (after it says CHECKSUM failure).  do:
&gt;         OK set-defaults
&gt;         OK set-defaults
&gt;     then power-cycle
&gt;
&gt; SS2 --  you need to boot from a good NVRAM, then hot-swap the &quot;bad&quot; one
&gt;     and &quot;set-defaults&quot;.  Only if the L1-N (or is it L1-D) thingy
&gt;     doesn't work for you.
</PRE>
<H2><A NAME="attach"></A>Attaching a new battery onto an existing M48T02</H2>
<P>My take on this procedure is that it isn't worth trying to save the US$20 it
would take to buy a new M48T02. This procedure requires considerable care. I'm
including this excerpt from the old NVRAM FAQ for completeness.</P>
<P>The contents of the (nv)ram are backed up by a 3V lithium battery. It's
located together with a quartz on top of the ram in a kind of backpack. The
battery is on the side that's opposed to the dot marking pin 1, next to pin 12:</P>
<PRE>                        _oscillator
                        /
                       / _battery
                      / /
                   -------
                   | O O | &lt;-- cut here
                   -------
                  /
             Pin 1
</PRE>
<P>At the point marked above, some kind of nose is reaching down from the
backpack over the resin. Carefully cut through the polyester resin filling the
dimple. This works best with some kind of mini drill with a small milling head
or a razor knife. Buried in the resin you'll find two small diagonal metal
connectors :).</P>
<P>Be careful not to short-circuit them, or you'll loose the contents of your
nvram (if it was still able to keep them). -That's why you should save them
*before* :)</P>
<P>The connector closest to pin 12 is ground, the other (opposing) one +3V. You
can now solder some wire to them and connect them to a new 3V lithium battery.</P>
<H2><A NAME="clock"></A>How to start and stop the NVRAM clock on the Sun 3/80
and sun4c machines</H2>
<P>The following information on starting and stopping the clock in the NVRAM
chip on the Sun 3/80 was contributed by simonallen@cix.compulink.co.uk. I've
added the tables and the sun4c information below. As it says below, you don't
normally need to do this. Sun OS will take care of starting the clock on a new
NVRAM chip for you.</P>
<PRE>Procedure to 'kick start' a new MK48T02 NVRAM clock chip on Sun 3/80
 
WARNING : This procedure is intended to be used on new, blank NVRAM chips only.
If you are using it on an existing NVRAM (for some unknown reason) you should
follow the procedures described in 'Backing up your NVRAM'.
 
This procedure shouldn't normally be necessary as SunOS provides this
functionality as part of the normal clock initialisation.  However, it may
prove useful in unforeseen circumstances.
 
The step numbers correspond to the step numbers in the SGS-Thomson
data sheet procedure for 'kick starting' the clock.
 
The data sheet warns NOT to leave the kick start bit set to 1 for normal use
as this will cause excessive current drain and shorten the life of the battery.
It does not mention if this is dangerous or by how much the life of the battery
is shortened...:-(
 
The kick start bit is the MSB in location 7FB
 
(The old NVRAM contents will be displayed by the monitor in the place
marked XX in the steps below.)
 
First halt the machine and get to the monitor prompt.
 
&gt; q 7f8
EEPROM 7F8: XX? 80              Step 1. Set write bit (enable write)
EEPROM 7F9: XX? 0               Step 2. Reset stop bit (not stopped)
EEPROM 7FA: XX? (Press Enter)
EEPROM 7FB: XX? 80              Step 3. Set kick start
EEPROM 7FC: XX? q
&gt; q 7f8
EEPROM 7F8: XX? 0               Step 4. Reset write (disable write)
EEPROM 7F9: XX? q
                                Step 5. Wait for 2 seconds.
&gt; q 7f8
EEPROM 7F8: XX? 80              Step 6. Set write bit
EEPROM 7F9: XX? q
EEPROM 7FA: XX? (Press Enter)
EEPROM 7FB: XX? 0               Step 7. Reset kick start
EEPROM 7FC: XX? q
&gt; q 7f9
EEPROM 7F9: XX? 0               Step 8. Set a dummy time &amp; date...
EEPROM 7FA: XX? 0
EEPROM 7FB: XX? 0
EEPROM 7FC: XX? 4
EEPROM 7FD: XX? 11
EEPROM 7FE: XX? 1
EEPROM 7FF: XX? 96
&gt; q 7f8
EEPROM 7F8: XX? 0               Step 9. Reset write bit
EEPROM 7F9: XX? q

And that's it.
Double check that the Kick Start bit is set to zero by doing the following :
 
&gt; q 7fb
EEPROM 7FB: XX? q
 
XX should be a value less than 80 Hex.  If it isn't repeat the procedure
again.

The related and opposite function to this is Stopping the Clock in the NVRAM.
When the clock is stopped, the storage life of the battery is extended because
the oscillator is not running.  This might be useful if you intend to put the
machine into storage or not use it for a while.
 
Again, halt the machine and get to the monitor prompt.

&gt; q 7f8
EEPROM 7F8: XX? 80              Set write bit
EEPROM 7F9: XX? 80              Set stop bit
EEPROM 7FA: XX? q
&gt; q 7f8
EEPROM 7F8: XX? 0               Reset write bit
EEPROM 7F9: XX? q
 
Simon Allen  simonallen@cix.compulink.co.uk 1996.
</PRE>
<P>As Simon Allen mentions, the kick-start procedure is not normally necessary
as Sun OS automatically starts the lock in an NVRAM with a stopped clock.
However, if you are putting a machine into long term storage, it is nice to be
able to stop the clock as doing this will significantly lower current drain on
the battery. The following information from the M48T02 data sheet gives
information on the clock.</P>
<TABLE BORDER="BORDER">
<CAPTION>The M48T02 Register Map</CAPTION>
<TR>
<TD VALIGN="MIDDLE" ALIGN="CENTER" ROWSPAN="2">Address</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER" COLSPAN="8">Data</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER" COLSPAN="2" ROWSPAN="2">Function</TD></TR>
<TR>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 7</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 6</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 5</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 4</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 3</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 2</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 1</TD>
<TD VALIGN="MIDDLE" ALIGN="CENTER">Bit 0</TD></TR>
<TR>
<TD VALIGN="TOP" ALIGN="CENTER"><TT>7ff</TT></TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Year</TD>
<TD ALIGN="CENTER"><TT>00-99</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7fe</TT></TD>
<TD>0</TD>
<TD>0</TD>
<TD>0</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Month</TD>
<TD ALIGN="CENTER"><TT>01-12</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7fd</TT></TD>
<TD>0</TD>
<TD>0</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Date</TD>
<TD ALIGN="CENTER"><TT>01-31</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7fc</TT></TD>
<TD>0</TD>
<TD>FT</TD>
<TD>0</TD>
<TD>0</TD>
<TD>0</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Day</TD>
<TD ALIGN="CENTER"><TT>01-07</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7fb</TT></TD>
<TD>KS</TD>
<TD>0</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Hours</TD>
<TD ALIGN="CENTER"><TT>00-23</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7fa</TT></TD>
<TD>0</TD>
<TD VALIGN="TOP" ALIGN="LEFT">-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Minutes</TD>
<TD ALIGN="CENTER"><TT>00-59</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7f9</TT></TD>
<TD>ST</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Seconds</TD>
<TD ALIGN="CENTER"><TT>00-59</TT></TD></TR>
<TR>
<TD ALIGN="CENTER"><TT>7f8</TT></TD>
<TD>W</TD>
<TD>R</TD>
<TD>S</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD>-</TD>
<TD ALIGN="RIGHT">Control</TD>
<TD></TD></TR></TABLE>
<UL>
<LI>ST is STOP BIT</LI>
<LI>W is WRITE BIT</LI>
<LI>R is READ BIT</LI>
<LI>S is SIGN BIT</LI>
<LI>FT is FREQ TEST BIT</LI>
<LI>KS is KICK START BIT</LI></UL>
<H3>Instructions for starting the clock</H3>
<OL>
<LI>Set the Write Bit to 1</LI>
<LI>Reset the Stop Bit to 0</LI>
<LI>Set the Kick Start Bit to 1</LI>
<LI>Reset the Write Bit to 0</LI>
<LI>Wait two seconds</LI>
<LI>Set the Write Bit to 1</LI>
<LI>Reset the Kick Start Bit to 0</LI>
<LI>Set the Correct Time and Date</LI>
<LI>Reset the Write Bit to 0</LI></OL>
<P><SMALL>N.B. Leaving the KS bit set will cause the Clock to draw excessive
current and will shorten the battery life.</SMALL></P>
<H3>Instructions for stopping the clock</H3>
<OL>
<LI>Set the Write Bit to 1</LI>
<LI>Set the Stop Bit to 1</LI>
<LI>Reset the Write Bit to 0</LI></OL>
<P>Given the above tables, Simon Allen's instructions for the 3/80, and the
next section on which tells how to map the NVRAM to virtual memory on sun4c
machines, it is a relatively easy matter to see how to stop and start the clock
on a sun4c machine.</P>
<H3>Stopping the clock on a sun4c machine</H3>
<PRE>2000000 obio 0 map-page             map NVRAM to page 0
80 7f8 c!                           set write bit
80 7f9 c!                           set stop bit
0 7f8 c!                            reset write bit
</PRE>
<H3>Starting the clock on a sun4c machine</H3>
<PRE>2000000 obio 0 map-page             map NVRAM to page 0
80 7f8 c!                           set write bit
0 7f9 c!                            reset stop bit
80 7fb c!                           set kick start
0 7f8 c!                            reset write bit
wait for two seconds
 
80 7f8 c!                           set write bit
0 7fb c!                            reset kick start
 
0 7f9 c!                            set dummy time and date 
0 7fa c!                            (if necessary)
0 7fb c!
4 7fc c!
11 7fd c!
1 7fe c!
96 7ff c!
 
0 7f8 c!                            reset write bit
</PRE>
<H2><A NAME="arcane"></A>Other more arcane methods for modifying the IDPROM</H2>
<P><KBD>mkp</KBD> and <KBD>mkpl</KBD> are not the only way to modify the
IDPROM. Before I discovered these commands, I used to use procedures like the
ones below. The material in this section assumes that you have access to the
OpenBoot PROM manual which is part of the Solaris 2.x Answerbook.</P>
<P>You can use the OpenBoot monitor to find the virtual address of the NVRAM.
The basic steps are:</P>
<OL>
<LI>cd to the eeprom device (you can find its exact name via <KBD>show-devs</KBD>)</LI>
<LI>execute <KBD>.attributes</KBD> or <KBD>.properties</KBD> depending upon
whether you have V2 or V3 of the OpenBoot PROM.</LI>
<LI>execute <KBD>device-end</KBD> followed by <KBD>reset</KBD></LI></OL>
<P>For example</P>
<PRE>    ok show-devs
    ...
    /obio/eeprom@0,200000
    ...
    ok cd /obio/eeprom@0,200000
    ok .attributes
    address: ffee9000
    ...
    ok device-end
    ok reset
</PRE>
<P>From this point, you can modify and look at the NVRAM by using the <KBD>c!</KBD>,
<KBD>dump</KBD>,and <KBD>c?</KBD> commands in the OpenBoot PROM. You can also
get the virtual address of the NVRAM by looking at the output of <KBD>/usr/etc/devinfo
-vp</KBD> under Sun OS 4.1.x or <KBD>/usr/sbin/prtconf -vp</KBD> under Solaris
2.x. On sun4c machines, the IDPROM starts at offset 0x7d8 from the start of the
NVRAM. On sun4m, sun4d, and sun4u machines the offset is 0x1fd8.</P>
<P>From here one can also find the physical address of the NVRAM using <KBD>pgmap?</KBD>.
In the above example, if we type <KBD>ffee9000 pgmap?</KBD> at the OpenBoot
prompt, we get a few lines of output, one of which is</P>
<PRE>Physical: 0.7120.0000</PRE>
<P>which means on this machine the physical address is 71200000 in address
space 0.</P>
<P>You can also use <KBD>map-page</KBD> to map the physical address of the
page containing the IDPROM to virtual address 0. To do this you need to know the
physical address of the NVRAM. You can find it as above or just use the
following table:</P>
<TABLE BORDER="BORDER" CELLPADDING="5">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>machine type</TD>
<TD>address</TD>
<TD>space</TD>
<TD>arch -k</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>SS1, SS1+, SS2, ELC, IPC, IPX, SLC</TD>
<TD><TT>02000000</TT></TD>
<TD><TT>obio</TT></TD>
<TD>sun4c</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>Classic, LX, SS5, SS4, Voyager</TD>
<TD><TT>71200000</TT></TD>
<TD><TT>0</TT></TD>
<TD>sun4m</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>SS10, SS20, 6x0/MP</TD>
<TD><TT>f1200000</TT></TD>
<TD><TT>f</TT></TD>
<TD>sun4m</TD></TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD>SS1000</TD>
<TD><TT>00280000</TT></TD>
<TD><TT>f</TT></TD>
<TD>sun4d</TD></TR></TABLE>
<P>For the sun4m and sun4d machines, the page size is 4kB (0x1000) so the
simplest thing to do is map the second page of the NVRAM. This is because we're
using <KBD>map-page</KBD> and it only maps one page at a time.</P>
<P>e.g. Modify the hostid of an IPX to be 57c0ffee and the ethernet address to
be 8:0:20:c0:ff:ee</P>
<PRE>02000000 obio 0 map-page
1 7d8 c!
57 7d9 c!
08 7da c!
0 7db c!
20 7dc c!
c0 7dd c!
ff 7de c!
ee 7df c!
57 7e0 c!
0 7e1 c!
0 7e2 c!
0 7e3 c!
c0 7e4 c!
ff 7e5 c!
ee 7e6 c!
29 7e7 c!
</PRE>
<P>e.g. to modify the hostid of an SS10 to be 72c0ffee and the ethernet address
to be 08:00:20:c0:ff:ee, do the following</P>
<PRE>f1201000 f 0 map-page
01 fd8 c!
72 fd9 c!
08 fda c!
0 fdb c!
20 fdc c!
c0 fdd c!
ff fde c!
ee fdf c!
72 fe0 c!
0 fe1 c!
0 fe2 c!
0 fe3 c!
c0 fe4 c!
ff fe5 c!
ee fe6 c!
29 fe7 c!
</PRE>
<P>Note that we added 0x1000 to the physical address in the above table, as
explained above.</P>
<H2><A NAME="intel"></A>The hostid on Solaris 2.5 x86</H2>
<P>Intel processor machines don't have an IDPROM. Sun uses a different
mechanism to generate the hostid. When the operating system is initially
installed a pseudo-random hostid is generated. It appears that this
pseudo-randomly generated hostid will always be between 1 and 3b9aca00. The
hostid is based on eight bytes of serialisation information in the kernel module
<TT>/kernel/misc/sysinit</TT>.  This is in contrast to the situation on  SPARC
machines where the hostid is based on the IDPROM. </P>
<P><TT>/kernel/misc/sysinit</TT> contains code which initialises the variable
<TT>hw_serial</TT> in the kernel based on the serialisation information.  On
both SPARC and x86 versions of Solaris 2.5, <TT>hw_serial</TT> stores the
hostid as a decimal C string. </P>
<P>Other than the eight bytes of serialisation information the <TT>/kernel/misc/sysinit</TT>
files do not differ between machines. Four of the serialisation bytes depend
upon the other four bytes, so the hostid is somewhat tamper resistant. If the
serialisation information  is tampered with carelessly or the sysinit module
fails to load for some other reason, the hostid of the machine will be 0. A
little more obfuscation is done in the code, i.e.
<TT>hw_serial</TT> is not referenced directly in the module, but indirectly via
the pointer <TT>_hs1107</TT>.</P>
<P>This means that if you need to have two machines with the same hostid for
some reason (say, to have a backup server with the same hostid in case your
primary server malfunctions), you can just copy the <TT>/kernel/misc/sysinit</TT>
file from one machine to another.</P>
<P>Moreover, it seems that initialising <TT>hw_serial</TT> is the <B>only</B>
function performed by the sysinit module. Hence, it is a simple matter to
replace <TT>/kernel/misc/sysinit</TT> yielding a machine with whatever hostid
one wants, by compiling a simple C program for a loadable kernel module which
sets <TT>hw_serial</TT> to the desired value.</P>
<P>C code for a generic replacement sysinit module is included in
<A HREF="http://www.squirrel.com/squirrel/sun-stuff/change-sun-hostid.tar.gz">change
sun hostid</A> which is available from the sites listed <A HREF="#hidsites">near
the beginning of this document</A>. Replacing part of the operating system is
probably not the best way to achieve this effect. In general, I'd recommend
using one of the other modules in
<A HREF="http://www.squirrel.com/squirrel/sun-stuff/change-sun-hostid.tar.gz">change
sun hostid</A> as there is less risk of damaging things and rendering the system
unbootable, but a few people have asked for this.</P>
<H2><A NAME="sun4"></A>The NVRAM in sun4 architecture machines</H2>
<P>The sun4 machines (e.g. Sun 4/1xx, 4/2xx, 4/3xx, etc.) also have M48T02
chips. These chips do not store the hostid and ethernet address, which are  in
an actual PROM, but they do keep track of the time of day and the system
configuration information. Replacing the NVRAM chip is a relatively simple
matter, the only trick is to set the appropriate values in the Sun PROM monitor
using the <TT>q</TT> command then boot the operating system to kick-start the
clock. You can use the <A HREF="#SUN3TBL">table for the Sun 3/80</A> to set the
values in the old Sun PROM monitor. The only significant difference is that
normal/diagnostic boot is controlled by a physical switch instead of the byte at
location 0x70b. See the <A HREF="ftp://ftp.picarefy.com/pub/Sun-Hardware-Ref">Sun
Hardware Reference</A> (referred to above), your machine documentation, or the
Sun FE Handbook if you need more information on the Sun PROM monitor.</P>
<H2><A NAME="classic"></A>SparcClassic /Classic X Terminal NVRAM differences</H2>
<P>This section was supplied by <A HREF="mailto:gcook@netwiz.net">Gary Cook &lt;gcook@netwiz.net&gt;</A>.
I have not been able to try this personally because I don't currently have
access to this type of machine.</P>
<P>Change the following locations in NVRAM to switch between Classic and
Classic </P>
<TABLE BORDER="BORDER" CELLPADDING="5">
<TR>
<TD>Address</TD>
<TD>ClassicX Value</TD>
<TD>Classic Value</TD></TR>
<TR>
<TD><TT>71202004</TT></TD>
<TD><TT>ff</TT></TD>
<TD><TT>00</TT></TD></TR>
<TR>
<TD><TT>71202005</TT></TD>
<TD><TT>12</TT></TD>
<TD><TT>00</TT></TD></TR>
<TR>
<TD><TT>71202006</TT></TD>
<TD><TT>08</TT></TD>
<TD><TT>00</TT></TD></TR>
<TR>
<TD><TT>71202007</TT></TD>
<TD><TT>36</TT></TD>
<TD><TT>00</TT></TD></TR></TABLE>
<P>Notes:</P>
<UL>
<LI>Classic X requires all locations to be set to above values.  If they are
not, the system takes on the Classic personality.</LI>
<LI>Bootprom for Classic X cannot be Version 2.9.  This version will ignore the
above NVRAM changes.  Classic X requires earlier versions, such as 2.12.
</LI></UL>
<H3>Procedure</H3>
<H4>Classic --&gt; Classic X</H4>
<PRE>ok
ff 71202004 20 spacec!
12 71202005 20 spacec!
08 71202006 20 spacec!
36 71202007 20 spacec!
</PRE>
<H4>Classic X --&gt; Classic</H4>
<PRE>ok
00 71202004 20 spacec!
00 71202005 20 spacec!
00 71202006 20 spacec!
00 71202007 20 spacec!
</PRE>
<H2><A NAME="enterprise"></A>Enterprise Server NVRAM Programming</H2>
<P>This section was supplied by <A HREF="mailto:gcook@netwiz.net">Gary Cook &lt;gcook@netwiz.net&gt;</A>.
I have not been able to try this personally because I don't currently have
access to this type of machine.</P>
<P>I had an opportunity to experiment with some Enterprise 3000/4000/5000/6000
systems and thought I would pass along what I found.
</P>
<P>The procedure works the same as listed in the FAQ for other systems: <KBD>&lt;value&gt;
&lt;location&gt; mkp</KBD></P>
<P>80 is the system type for all Enterprise X000 systems.  As has been the
recent trend, the last 3 digits of the ethernet address are also the ones used
by the hostid.
</P>
<P>The checksum procedure works the same too</P>
<PRE>0 f 0 do i idprom@ xor loop f mkp</PRE>
<P>hen writing to the Enterprise X000 NVRAM, you are writing to the one located
on the clock board.  Once it is programmed, you can copy it's contents to the
NVRAM's on the I/0 boards by using the command:</P>
<PRE>copy-clock-tod-to-io-boards</PRE>
<P>You can also program a blank or corrupt NVRAM on a board by copying a valid
copy from another board.  Only the clock board and I/O boards have NVRAMs. The
CPU/Memory boards do not have NVRAMs.
</P>
<P>Example:  Copy from an I/O board NVRAM in slot 1 to the clock board NVRAM.</P>
<PRE>01 copy-io-board-tod-to-clock-tod</PRE>
<P>NOTE: 01 above is the slot number of the I/0 board.</P>
<P>After self test, you may get a message saying the Clock TOD does not match
any I/0 boards.  This may have been caused by swapping the clock or I/O board
without keeping the original NVRAM.  It can also be caused by a glitch in the
Boot PROM code that causes the system to think there is a mismatch after you
power off the system.  Sun has a patch or fix for this problem. You can
reprogram the Flash memory with an update.
</P>
<P>To fix the mismatch, you have a choice of updating the clock NVRAM from an
I/O board or the other way around.  Keep in mind that the one displayed in the
banner is the one on the clock board.  If the clock board has the correct
hostid, then update all the I/O boards with a single command: 
</P>
<PRE>copy-clock-tod-to-io-boards</PRE>
<P>If one of the I/O boards has the correct hostid, then copy it's contents to
the clock board with: (Change 01 to equal the slot # of the valid I/O board.)</P>
<PRE>01 copy-io-board-tod-to-clock-tod</PRE>
<P>You should be able to examine the contents of each I/0 board's NVRAM to see
which one has the correct hostid / Ethernet address.
</P>
<HR>
<P><A NAME="CREDITS"></A></P>
<H1>Credits</H1>
<P>I'd like to thank the following people who have helped make this a better
document. If I've left anyone off this list who should be on it please
<A HREF="mailto:mch@squirrel.com">drop me a note</A> and I'll add the name to
the list.</P>
<UL>
<LI>Kevin Murty for the use of an SS1000 for testing</LI>
<LI>simonallen@cix.compulink.co.uk for the kick-start information, information
on the Sun OS 4.1 clock bug on the 3/80, a U.K. source of NVRAM chips.</LI>
<LI>Michael Firth &lt;mfirth@visual.bt.co.uk&gt; for a U.K. source of NVRAM
chips.</LI>
<LI>dowdy@cs.colorado.edu (Stephen Dowdy)</LI>
<LI>drzob@vectrex.login.qc.ca (Denis Solaro)</LI>
<LI>coughlin@cfa0.harvard.edu (Michael Coughlin) for numerous suggestions and
bits of information.</LI>
<LI>sameer@c2.org</LI>
<LI>Kenji Oshima &lt;kosmic@jaist.ac.jp&gt; for the GIF image of a M48T02 and a
source for replacement NVRAM chips in Japan.</LI>
<LI>Eddie Berin</LI>
<LI>Marek Jedryszek &lt;djslamm@pg.gda.pl&gt;</LI>
<LI>Andy Michael &lt;andy@plumgate.demon.co.uk&gt;</LI>
<LI>Bernd Wagner &lt;bwagner@applix.de&gt;</LI>
<LI>Lonnie Borntreger &lt;67goat@exchange.wcc.att.com&gt;</LI>
<LI>Jay York &lt;jyork@smart.net&gt;</LI>
<LI>James Lin &lt;linja@fasecon.econ.nyu.edu&gt;</LI>
<LI>Werner Lappessen &lt;wlappess@ford.com&gt;</LI>
<LI>Stanislav Sinyagin &lt;stas@isf.ru&gt;</LI>
<LI>Mikael Bergqvist &lt;mbq@aronnax.physto.se&gt;</LI>
<LI>Klaus Koehnlein &lt;klaus.koehnlein@uni-tuebingen.de&gt;</LI>
<LI>NoRM &lt;norm@mono.org&gt;</LI>
<LI>R. Blake Von Haden &lt;bvh@mspusa.com&gt;</LI>
<LI>Jon Laughton &lt;jon@eoin.demon.co.uk&gt;</LI>
<LI>Tatjana Heuser &lt;pierrot@sarastro.isdn.cs.tu-berlin.de&gt;</LI>
<LI>Adrie Koolen &lt;adrie@ica.philips.nl&gt;</LI>
<LI>J&quot;org Schilling &lt;js@cs.tu-berlin.de&gt;</LI>
<LI>H Richardson &lt;harvey@tromba.demon.co.uk&gt;</LI>
<LI>Alexander Shenkin &lt;ashenkin@wdl.lmco.com&gt;</LI>
<LI>Jill Holliday &lt;jill@lynxuk.demon.co.uk&gt;</LI>
<LI>Tim Hogard &lt;thogard@abnormal.com&gt;</LI>
<LI>Gary W. Cook &lt;gcook@netwiz.net&gt; for the information on the
Classic/ClassicX differences and on Enterprise server NVRAM programming</LI></UL></BODY></HTML>
